<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2DMaterialDet - CVD二维材料厚度检测平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 基础样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
        }

        .back-btn {
            display: flex;
            align-items: center;
            color: #854144;
            text-decoration: none;
            font-weight: 500;
            margin-right: 20px;
        }

        .back-btn i {
            margin-right: 5px;
        }

        .page-header h1 {
            font-size: 28px;
            color: #2c3e50;
        }

        .page-title {
            display: flex;
            align-items: center;
            font-size: 24px;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        .page-title i {
            margin-right: 10px;
            color: #854144;
        }

        /* Step1页面专用样式 */
        .step1-layout {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 20px;
        }

        .step1-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: #854144;
        }

        .section-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #854144;
            background: #f8f0f1;
        }

        .upload-area.active {
            border-color: #854144;
            background: #f2e6e7;
        }

        .upload-icon {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
        }

        .upload-area.active .upload-icon {
            color: #854144;
        }

        .upload-text {
            margin-bottom: 15px;
            color: #666;
        }

        .upload-btn {
            background: #854144;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .upload-btn:hover {
            background: #6a3336;
        }

        .param-panel {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .param-panel h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 20px;
        }

        .param-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .param-group {
            flex: 1;
            min-width: 180px;
        }

        .param-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .param-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .primary-btn {
            background: #854144;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .primary-btn:hover {
            background: #6a3336;
        }

        .secondary-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .secondary-btn:hover {
            background: #5a6268;
        }

        .results-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: 100%;
        }

        .results-title {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 22px;
            color: #2c3e50;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .result-box {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .result-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 18px;
        }

        .result-image-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            background: #fafafa;
            overflow: hidden;
            min-height: 200px;
        }

        .result-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .placeholder-text {
            color: #999;
            font-style: italic;
        }

        /* 进度条样式 */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #854144;
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
        }

        /* 状态指示器 */
        .status-indicator {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-dot.idle {
            background: #ccc;
        }

        .status-dot.training {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        .status-dot.completed {
            background: #4caf50;
        }

        .status-dot.error {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* 模型信息卡片 */
        .model-cards {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .model-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 200px;
            border-left: 4px solid #854144;
        }

        .model-card h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .model-card p {
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }

        /* 按钮样式 */
        .start-btn {
            background: #854144;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .start-btn:hover {
            background: #6a3336;
        }

        .pipeline-actions {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* 选择页面样式 */
        .selection-main {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 50px;
        }

        .option-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 350px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-icon {
            font-size: 48px;
            color: #854144;
            margin-bottom: 20px;
        }

        .option-card h2 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .option-card p {
            color: #666;
            margin-bottom: 20px;
        }

        /* 登录页面样式 */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .login-header p {
            color: #666;
        }

        .login-header a {
            color: #854144;
            text-decoration: none;
        }

        .google-login-btn {
            width: 100%;
            padding: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .google-login-btn:hover {
            background: #f5f5f5;
        }

        .google-login-btn i {
            margin-right: 10px;
            color: #db4437;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #eee;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            color: #666;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #854144;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .login-btn:hover {
            background: #6a3336;
        }

        .forgot-password {
            text-align: center;
            margin-top: 15px;
        }

        .forgot-password a {
            color: #854144;
            text-decoration: none;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }

        .logo i {
            margin-right: 10px;
            color: #854144;
        }

        /* 检测页面样式 */
        .detection-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }

        .main-option {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .main-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .option-icon {
            font-size: 48px;
            color: #854144;
            margin-bottom: 15px;
        }

        /* 结果页面样式 */
        .result-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: #854144;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .action-btn:hover {
            background: #6a3336;
        }

        .image-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .image-container img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .arrow {
            font-size: 30px;
            color: #854144;
        }

        .text-results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .site-results {
            margin-top: 15px;
        }

        .site-results p {
            margin-bottom: 10px;
        }

        /* 输出页面样式 */
        .output-options {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 50px;
        }

        .output-btn {
            background: white;
            border: none;
            border-radius: 10px;
            padding: 30px;
            width: 200px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .output-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .output-icon {
            margin-bottom: 15px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .csv-icon {
            position: relative;
        }

        .doc-lines {
            width: 60px;
            height: 8px;
            background: #854144;
            margin-bottom: 5px;
            border-radius: 2px;
        }

        .csv-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
        }

        .jpg-icon {
            font-size: 48px;
            color: #854144;
        }

        /* Step2 布局样式 */
        .step2-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .step2-left {
            flex: 1;
        }

        .step2-right {
            flex: 1;
        }

        /* Step3 页面专用样式 */
        .step3-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .step3-left {
            flex: 1;
        }

        .step3-right {
            flex: 1;
        }

        .step3-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        /* 厚度结果表格 */
        .thickness-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .thickness-table th,
        .thickness-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }

        .thickness-table th {
            background-color: #f5f5f5;
            font-weight: 600;
            color: #2c3e50;
        }

        .thickness-table tr:hover {
            background-color: #f9f9f9;
        }

        .region-color {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* 厚度分布图 */
        .thickness-chart {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .chart-placeholder {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
            border: 1px dashed #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-header">
                <h1>Welcome Back</h1>
                <p>Don't have an account? <a href="#" onclick="showSignup()">Sign up for free</a></p>
            </div>

            <div class="login-options">
                <button class="google-login-btn" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i>
                    Log in with Google
                </button>

                <div class="divider">
                    <span>or Log in with:</span>
                </div>

                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="account">Account</label>
                        <input type="text" id="account" placeholder="Enter your username or email" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password" required>
                    </div>

                    <button type="submit" class="login-btn">Login</button>

                    <div class="forgot-password">
                        <a href="#" onclick="showForgotPassword()">Forgot password?</a>
                    </div>
                </form>
            </div>

            <div class="footer">
                <div class="logo">
                    <i class="fas fa-atom"></i>
                    <span>2DMaterialDet.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 选择页面 -->
    <div id="selectionPage" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>selection</h1>
            </header>

            <main class="selection-main">
                <div class="option-card" onclick="goToDatabase()">
                    <div class="card-icon">
                        <i class="fas fa-folder"></i>
                    </div>
                    <h2>Material Database</h2>
                    <p>Explore comprehensive 2D material indexes and properties. Gain insights into various material compositions, characteristics, and applications.</p>
                    <button class="start-btn">Start</button>
                </div>

                <div class="option-card" onclick="goToDetection()">
                    <div class="card-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <h2>Material Detection</h2>
                    <p>Upload images to identify and analyze material compositions. Get precise results and detailed reports for various materials.</p>
                    <button class="start-btn">Start</button>
                </div>
            </main>
        </div>
    </div>

    <!-- 材料数据库页面 -->
    <div id="databasePage" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToSelection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Material Database</h1>
            </header>

            <div class="search-section">
                <div class="search-bar">
                    <input type="text" placeholder="Search for materials (e.g., WS2, MoS2, Graphene)" id="searchInput" onkeyup="handleSearch(event)">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <!-- 搜索结果展示区域 -->
            <div id="searchResults" class="search-results" style="display: none;">
                <h3>Search Results for "<span id="searchQuery"></span>"</h3>
                <div id="materialResults" class="materials-grid">
                    <!-- 搜索结果将在这里动态生成 -->
                </div>
            </div>

            <main class="database-main">
                <h2 class="section-title">
                    <i class="fas fa-layer-group"></i>
                    Material Categories
                </h2>

                <div class="material-categories">
                    <button class="category-btn" onclick="showCategory('metals')">
                        <i class="fas fa-magnet"></i>
                        <span>2D Metals & Alloys</span>
                    </button>

                    <button class="category-btn" onclick="showCategory('nitrides')">
                        <i class="fas fa-atom"></i>
                        <span>2D Carbon Nitrides</span>
                    </button>

                    <button class="category-btn" onclick="showCategory('organic')">
                        <i class="fas fa-wrench"></i>
                        <span>2D Organic Materials</span>
                    </button>

                    <button class="category-btn" onclick="showCategory('tmds')">
                        <i class="fas fa-flask"></i>
                        <span>Transition Metal Dichalcogenides</span>
                    </button>

                    <button class="category-btn" onclick="showCategory('graphene')">
                        <i class="fas fa-gem"></i>
                        <span>Graphene Family</span>
                    </button>

                    <button class="category-btn" onclick="showCategory('silicon')">
                        <i class="fas fa-microchip"></i>
                        <span>2D Silicon Materials</span>
                    </button>
                </div>

                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    Popular Materials
                </h2>

                <div class="materials-grid" id="popularMaterials">
                    <!-- 热门材料卡片将在这里动态生成 -->
                </div>
            </main>

            <footer class="page-footer">
                <span>2DMaterialDet. &copy; 2023 - Advanced 2D Material Analysis Platform</span>
            </footer>
        </div>
    </div>


    <!-- 材料检测页面 -->
    <div id="detectionPage" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToSelection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Shooting</h1>
            </header>

            <main class="detection-main">
                <h2 class="page-title">
                    <i class="fas fa-camera"></i>
                    Material Detection
                </h2>

                <div class="detection-options">
                    <div class="main-option" onclick="takePicture()">
                        <div class="option-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <span>Take pictures with the device</span>
                    </div>
                </div>

                <!-- 一键运行 Step1/Step2/Step3 的控制区 -->
                <div class="pipeline-actions">
                    <button class="start-btn" onclick="goToStep1Page()">Run Step1 (recognition - model)</button>
                    <button class="start-btn" onclick="goToStep2Page()">Run Step2 (SLIC - region segmentation)</button>
                    <button class="start-btn" onclick="goToStep3Page()">Run Step3 (Thickness prediction)</button>
                    <input id="uploadImageInput" type="file" accept="image/*" style="display:none;" onchange="handleUploadInputChange(event)">
                </div>
            </main>
        </div>
    </div>

    <!-- Step1 模型训练和识别页面 -->
    <div id="step1Page" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToDetection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Step1 - Material Recognition Model</h1>
            </header>

            <main class="step1-main">
                <h2 class="page-title">
                    <i class="fas fa-brain"></i>
                    Material Recognition Model
                </h2>

                <div class="step1-layout">
                    <!-- 第一部分：模型训练 -->
                    <div class="step1-section">
                        <h3 class="section-title">
                            <i class="fas fa-graduation-cap"></i>
                            Model Training
                        </h3>
                        <p class="section-description">
                            Upload training dataset and configure training parameters to train a new material recognition model.
                        </p>

                        <div class="upload-area" id="trainingDataUploadArea" onclick="document.getElementById('trainingDataInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <p>Click to upload training dataset</p>
                                <p>Support ZIP format training data package, including images and annotation files</p>
                            </div>
                            <button class="upload-btn">Select File</button>
                        </div>
                        <input type="file" id="trainingDataInput" accept=".zip" style="display:none;" onchange="handleTrainingDataUpload(event)">

                        <div class="param-panel">
                            <h3>Training Parameters</h3>

                            <div class="param-row">
                                <div class="param-group">
                                    <label class="param-label" for="param_epochs">Epochs</label>
                                    <input class="param-input" id="param_epochs" type="number" value="50" min="1" max="500">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_batch_size">Batch Size</label>
                                    <input class="param-input" id="param_batch_size" type="number" value="16" min="1" max="128">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_learning_rate">Learning Rate</label>
                                    <input class="param-input" id="param_learning_rate" type="number" value="0.001" step="0.0001" min="0.0001" max="0.1">
                                </div>
                            </div>

                            <div class="param-row">
                                <div class="param-group">
                                    <label class="param-label" for="param_model_type">Model Type</label>
                                    <select class="param-input" id="param_model_type">
                                        <option value="resnet50">ResNet-50</option>
                                        <option value="efficientnet">EfficientNet</option>
                                        <option value="mobilenet">MobileNet</option>
                                        <option value="custom">Custom Model</option>
                                    </select>
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_optimizer">Optimizer</label>
                                    <select class="param-input" id="param_optimizer">
                                        <option value="adam">Adam</option>
                                        <option value="sgd">SGD</option>
                                        <option value="rmsprop">RMSprop</option>
                                    </select>
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_pretrained">Pretrained Weights</label>
                                    <select class="param-input" id="param_pretrained">
                                        <option value="yes">Use Pretrained Weights</option>
                                        <option value="no">Train from Scratch</option>
                                    </select>
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="primary-btn" onclick="startTraining()">Start Training</button>
                                <button class="secondary-btn" onclick="resetTrainingParams()">Reset Parameters</button>
                            </div>

                            <!-- 训练状态显示 -->
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="trainingProgress"></div>
                                </div>
                                <div class="progress-text" id="trainingProgressText">Ready to start training...</div>
                            </div>

                            <div class="status-indicator">
                                <div class="status-dot idle" id="trainingStatus"></div>
                                <span id="trainingStatusText">Waiting for training to start</span>
                            </div>
                        </div>
                    </div>

                    <!-- 第二部分：模型保存 -->
                    <div class="step1-section">
                        <h3 class="section-title">
                            <i class="fas fa-save"></i>
                            Model Saving
                        </h3>
                        <p class="section-description">
                            Save the trained model, or load an existing model for recognition.
                        </p>

                        <div class="action-buttons">
                            <button class="primary-btn" id="saveModelBtn" onclick="saveModel()" disabled>Save Model</button>
                            <button class="secondary-btn" onclick="loadModel()">Load Existing Model</button>
                        </div>

                        <div class="model-cards">
                            <div class="model-card">
                                <h4>Current Model</h4>
                                <p id="currentModelName">No model loaded</p>
                                <p id="currentModelAccuracy">Accuracy: -</p>
                                <p id="currentModelDate">Creation Date: -</p>
                            </div>
                            <div class="model-card">
                                <h4>Training Statistics</h4>
                                <p id="trainingLoss">Loss: -</p>
                                <p id="trainingAccuracy">Accuracy: -</p>
                                <p id="trainingTime">Training Time: -</p>
                            </div>
                        </div>
                    </div>

                    <!-- 第三部分：模型识别 -->
                    <div class="step1-section">
                        <h3 class="section-title">
                            <i class="fas fa-search"></i>
                            Material Recognition
                        </h3>
                        <p class="section-description">
                            Use the trained model to recognize and classify material images.
                        </p>

                        <div class="upload-area" id="recognitionImageUploadArea" onclick="document.getElementById('recognitionImageInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <p>Click to upload image for recognition</p>
                                <p>PNG, JPG, JPEG up to 10MB</p>
                            </div>
                            <button class="upload-btn">Select File</button>
                        </div>
                        <input type="file" id="recognitionImageInput" accept="image/*" style="display:none;" onchange="handleRecognitionImageUpload(event)">

                        <div class="action-buttons">
                            <button class="primary-btn" id="runRecognitionBtn" onclick="runRecognition()" disabled>Run Recognition</button>
                        </div>

                        <div class="results-container">
                            <div class="result-box">
                                <div class="result-label">Recognition Result</div>
                                <div class="result-image-container" id="recognitionResultContainer">
                                    <div class="placeholder-text" id="recognitionResultPlaceholder">
                                        Run recognition to see results
                                    </div>
                                    <img id="recognitionResultImage" class="result-image" src="" alt="Recognition Result" style="display: none;">
                                </div>
                            </div>
                        </div>

                        <div id="recognitionDetails" style="margin-top: 20px; display: none;">
                            <h4>Recognition Details</h4>
                            <div id="recognitionClasses"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Step2 参数设置和结果页面 -->
    <div id="step2Page" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToDetection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Step2 - Region Segmentation</h1>
            </header>

            <main class="step2-main">
                <h2 class="page-title">
                    <i class="fas fa-crop-alt"></i>
                    SLIC Region Segmentation
                </h2>

                <div class="step2-layout">
                    <!-- 左侧：上传和参数设置 -->
                    <div class="step2-left">
                        <!-- 文件上传区域 -->
                        <div class="upload-section">
                            <div class="upload-area" id="uploadArea" onclick="document.getElementById('step2ImageInput').click()">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">
                                    <p>Click to upload or drag and drop</p>
                                    <p>PNG, JPG, JPEG up to 10MB</p>
                                </div>
                                <button class="upload-btn">Select File</button>
                            </div>
                            <input type="file" id="step2ImageInput" accept="image/*" style="display:none;" onchange="handleStep2ImageUpload(event)">
                        </div>

                        <!-- Step2 参数面板 -->
                        <div class="param-panel">
                            <h3>Step2 Parameters (SLIC / Post-processing)</h3>

                            <div class="param-row">
                                <div class="param-group">
                                    <label class="param-label" for="param_slic_n_segments">SLIC n_segments</label>
                                    <input class="param-input" id="param_slic_n_segments" type="number" value="3000" min="100" step="1">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_slic_compactness">SLIC compactness</label>
                                    <input class="param-input" id="param_slic_compactness" type="number" value="5.0" step="0.1">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_meanshift_bandwidth">MeanShift bandwidth</label>
                                    <input class="param-input" id="param_meanshift_bandwidth" type="number" value="7" step="0.1">
                                </div>
                            </div>

                            <div class="param-row">
                                <div class="param-group">
                                    <label class="param-label" for="param_min_internal_area_post">Min region area</label>
                                    <input class="param-input" id="param_min_internal_area_post" type="number" value="500" step="10">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_top_n_output">Top N output</label>
                                    <input class="param-input" id="param_top_n_output" type="number" value="5" min="1">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_shape_solidity_threshold">Solidity threshold</label>
                                    <input class="param-input" id="param_shape_solidity_threshold" type="number" value="0.65" step="0.01" min="0" max="1">
                                </div>
                            </div>

                            <div class="param-row">
                                <div class="param-group">
                                    <label class="param-label" for="param_morph_kernel_size">Morph kernel size</label>
                                    <input class="param-input" id="param_morph_kernel_size" type="number" value="3" step="1" min="1">
                                </div>
                                <div class="param-group">
                                    <label class="param-label" for="param_morph_iterations">Morph iterations</label>
                                    <input class="param-input" id="param_morph_iterations" type="number" value="2" step="1" min="0">
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="primary-btn" onclick="runStep2WithParams()">Run Step2 Segmentation</button>
                                <button class="secondary-btn" onclick="resetStep2Params()">Reset Defaults</button>
                            </div>

                            <div style="margin-top:15px;">
                                <small style="color:#666;">
                                    <strong>Reset Defaults:</strong> Reset all parameters to default values. Use this function when the adjusted parameters don't produce ideal results.
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：结果展示 -->
                    <div class="step2-right">
                        <div class="results-section">
                            <h3 class="results-title">Segmentation Results</h3>
                            <div class="results-container">
                                <div class="result-box">
                                    <div class="result-label">Original Image</div>
                                    <div class="result-image-container" id="originalImageContainer">
                                        <div class="placeholder-text" id="originalPlaceholder">
                                            Upload an image to see preview
                                        </div>
                                        <img id="step2OriginalImage" class="result-image" src="" alt="Original Image" style="display: none;">
                                    </div>
                                </div>
                                <div class="result-box">
                                    <div class="result-label">Segmentation Result</div>
                                    <div class="result-image-container" id="resultImageContainer">
                                        <div class="placeholder-text" id="resultPlaceholder">
                                            Run segmentation to see result
                                        </div>
                                        <!-- 这里可以替换为实际的分割结果图片路径 -->
                                        <img id="step2ResultImage" class="result-image" src="" alt="Segmentation Result" style="display: none;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Step3 厚度预测页面 -->
    <div id="step3Page" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToDetection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Step3 - Thickness Prediction</h1>
            </header>

            <main class="step3-main">
                <h2 class="page-title">
                    <i class="fas fa-ruler-combined"></i>
                    Thickness Prediction
                </h2>

                <div class="step3-layout">
                    <!-- 左侧：上传和参数设置 -->
                    <div class="step3-left">
                        <!-- 第一部分：图像上传 -->
                        <div class="step3-section">
                            <h3 class="section-title">
                                <i class="fas fa-file-upload"></i>
                                Image Upload
                            </h3>
                            <p class="section-description">
                                Upload the segmented 2D material image, and the system will analyze and predict the thickness of each region.
                            </p>

                            <div class="upload-area" id="step3UploadArea" onclick="document.getElementById('step3ImageInput').click()">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <div class="upload-text">
                                    <p>Click to upload the segmented image</p>
                                    <p>PNG, JPG, JPEG up to 10MB</p>
                                </div>
                                <button class="upload-btn">Select File</button>
                            </div>
                            <input type="file" id="step3ImageInput" accept="image/*" style="display:none;" onchange="handleStep3ImageUpload(event)">

                            <!-- 厚度预测结果图片路径输入 -->
                            <div class="param-panel" style="margin-top: 20px;">
                                <h3>Result Image Path</h3>
                                <div class="param-row">
                                    <div class="param-group" style="flex: 2;">
                                        <label class="param-label" for="resultImagePath">"runs\thickness\026\thickness_annotated_026.png"</label>
                                        <input class="param-input" id="resultImagePath" type="text" placeholder="Enter the path for thickness prediction result image" value="runs\thickness\026\thickness_annotated_026.png">
                                    </div>
                                </div>
                                <div style="margin-top:10px;">
                                    <small style="color:#666;">
                                        <strong>Note:</strong> This is the path where the thickness prediction result image will be saved or loaded from.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- 第二部分：参数设置 -->
                        <div class="step3-section">
                            <h3 class="section-title">
                                <i class="fas fa-sliders-h"></i>
                                Thickness Prediction Parameters
                            </h3>
                            <p class="section-description">
                                Configure the parameters for thickness prediction algorithm.
                            </p>

                            <div class="param-panel">
                                <h3>Prediction Parameters</h3>

                                <div class="param-row">
                                    <div class="param-group">
                                        <label class="param-label" for="param_threshold">Contrast Threshold</label>
                                        <input class="param-input" id="param_threshold" type="number" value="0.15" step="0.01" min="0" max="1">
                                    </div>
                                    <div class="param-group">
                                        <label class="param-label" for="param_sensitivity">Sensitivity</label>
                                        <input class="param-input" id="param_sensitivity" type="number" value="0.7" step="0.1" min="0" max="1">
                                    </div>
                                    <div class="param-group">
                                        <label class="param-label" for="param_min_area">Minimum Region Area</label>
                                        <input class="param-input" id="param_min_area" type="number" value="100" min="1">
                                    </div>
                                </div>

                                <div class="param-row">
                                    <div class="param-group">
                                        <label class="param-label" for="param_calibration">Calibration Coefficient (nm/pixel)</label>
                                        <input class="param-input" id="param_calibration" type="number" value="0.25" step="0.01" min="0">
                                    </div>
                                    <div class="param-group">
                                        <label class="param-label" for="param_confidence">Confidence Threshold</label>
                                        <input class="param-input" id="param_confidence" type="number" value="0.8" step="0.05" min="0" max="1">
                                    </div>
                                </div>

                                <div class="action-buttons">
                                    <button class="primary-btn" onclick="runThicknessPrediction()">Run Thickness Prediction</button>
                                    <button class="secondary-btn" onclick="resetThicknessParams()">Reset Parameters</button>
                                </div>
                            </div>

                            <!-- 处理状态显示 -->
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="thicknessProgress"></div>
                                </div>
                                <div class="progress-text" id="thicknessProgressText">Ready for thickness prediction...</div>
                            </div>

                            <div class="status-indicator">
                                <div class="status-dot idle" id="thicknessStatus"></div>
                                <span id="thicknessStatusText">Waiting to start processing</span>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：结果展示 -->
                    <div class="step3-right">
                        <div class="step3-section">
                            <h3 class="section-title">
                                <i class="fas fa-chart-bar"></i>
                                Thickness Prediction Results
                            </h3>
                            <p class="section-description">
                                View thickness prediction results and detailed analysis.
                            </p>

                            <div class="results-container">
                                <div class="result-box">
                                    <div class="result-label">Original Image</div>
                                    <div class="result-image-container" id="step3OriginalContainer">
                                        <div class="placeholder-text" id="step3OriginalPlaceholder">
                                            Upload an image to see preview
                                        </div>
                                        <img id="step3OriginalImage" class="result-image" src="" alt="Original Image" style="display: none;">
                                    </div>
                                </div>
                                <div class="result-box">
                                    <div class="result-label">Thickness Prediction Result</div>
                                    <div class="result-image-container" id="step3ResultContainer">
                                        <div class="placeholder-text" id="step3ResultPlaceholder">
                                            Run thickness prediction to see results
                                        </div>
                                        <img id="step3ResultImage" class="result-image" src="" alt="Thickness Prediction Result" style="display: none;">
                                    </div>
                                </div>
                            </div>

                            <!-- 厚度结果表格 -->
                            <div id="thicknessResults" style="display: none; margin-top: 20px;">
                                <h4>Regional Thickness Analysis</h4>
                                <table class="thickness-table">
                                    <thead>
                                        <tr>
                                            <th>Region</th>
                                            <th>Average Thickness (nm)</th>
                                            <th>Area (μm²)</th>
                                            <th>Confidence</th>
                                        </tr>
                                    </thead>
                                    <tbody id="thicknessTableBody">
                                        <tr>
                                            <td>Region 1</td>
                                            <td>53.3</td>
                                            <td>118424</td>
                                            <td>92%</td>
                                        </tr>
                                        <tr>
                                            <td>Region 2</td>
                                            <td>53.3</td>
                                            <td>19197</td>
                                            <td>95%</td>
                                        </tr>
                                        <tr>
                                            <td>Region 3</td>
                                            <td>53.3</td>
                                            <td>5304</td>
                                            <td>98%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 厚度分布图 -->
                            <div class="thickness-chart" id="thicknessChart" style="display: none;">
                                <h4>Thickness Distribution</h4>
                                <div class="chart-placeholder" id="chartPlaceholder">
                                    Thickness distribution chart will be displayed here
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 检测结果页面 -->
    <div id="resultPage" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToDetection()">
                    <i class="fas fa-arrow-left"></i> back
                </a>
                <h1>Result</h1>
            </header>

            <main class="result-main">
                <h2 class="page-title">
                    <i class="fas fa-star"></i>
                    Detection Result
                </h2>

                <div class="result-actions">
                    <button class="action-btn" onclick="goToOutput()">Output</button>
                    <button class="action-btn" onclick="retest()">Re-Test</button>
                </div>

                <div class="result-content">
                    <div class="images-section">
                        <div class="image-container">
                            <!-- 请将下面的图片路径替换为您的实际图片路径 -->
                            <img id="originalImage" src="images/026.jpg" alt="Original Image">
                            <span class="arrow">→</span>
                            <img id="processedImage" src="runs/results/026/final_result_026.jpg" alt="Processed Image">
                        </div>
                    </div>

                    <div class="result-details">
                        <div class="text-results">
                            <p>The object of this detection is a WS₂ two-dimensional film sample. The detection areas were selected from 3 different sites with no obvious defects on the sample surface (marked as A, B, and C).</p>

                            <div class="site-results">
                                <p><strong>Site 1:</strong> The thickness is <span id="siteA">40nm</span>, corresponding to the characteristic thickness of single-layer WS₂.</p>
                                <p><strong>Site 2:</strong> The thickness is <span id="siteB">20nm</span>, which is double-layer WS₂.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 输出格式页面 -->
    <div id="outputPage" class="page">
        <div class="page-container">
            <header class="page-header">
                <a href="#" class="back-btn" onclick="goToResult()">
                    <i class="fas fa-arrow-left"></i> Output format
                </a>
                <h1>Output</h1>
            </header>

            <main class="output-main">
                <div class="output-options">
                    <button class="output-btn" onclick="exportCSV()">
                        <div class="output-icon csv-icon">
                            <div class="doc-lines"></div>
                            <div class="doc-lines"></div>
                            <div class="doc-lines"></div>
                            <span class="csv-label">CSV</span>
                        </div>
                        <span>XXX.csv</span>
                    </button>

                    <button class="output-btn" onclick="exportJPG()">
                        <div class="output-icon jpg-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <span>XXX.jpg</span>
                    </button>
                </div>
            </main>
        </div>
    </div>

    <script>
        // ==================== 页面导航函数 ====================
        function goToStep1Page() {
            hideAllPages();
            document.getElementById('step1Page').classList.add('active');
        }

        function goToStep2Page() {
            hideAllPages();
            document.getElementById('step2Page').classList.add('active');
        }

        function goToStep3Page() {
            hideAllPages();
            document.getElementById('step3Page').classList.add('active');
        }

        function goToDetection() {
            hideAllPages();
            document.getElementById('detectionPage').classList.add('active');
        }

        function goToSelection() {
            hideAllPages();
            document.getElementById('selectionPage').classList.add('active');
        }

        function goToDatabase() {
            hideAllPages();
            document.getElementById('databasePage').classList.add('active');
        }

        function goToResult() {
            hideAllPages();
            document.getElementById('resultPage').classList.add('active');
        }

        function goToOutput() {
            hideAllPages();
            document.getElementById('outputPage').classList.add('active');
        }

        function goBack() {
            hideAllPages();
            document.getElementById('loginPage').classList.add('active');
        }

        function hideAllPages() {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
        }

        // ==================== 登录页面函数 ====================
        function showSignup() {
            alert('Sign up functionality would go here');
        }

        function loginWithGoogle() {
            alert('Google login would be implemented here');
        }

        function handleLogin(event) {
            event.preventDefault();
            // 在实际应用中，这里会有登录验证
            hideAllPages();
            document.getElementById('selectionPage').classList.add('active');
        }

        function showForgotPassword() {
            alert('Password reset functionality would go here');
        }

        // ==================== Step1 功能函数 ====================
        let isTraining = false;
        let trainingInterval;
        let currentProgress = 0;

        // 训练数据上传处理
        function handleTrainingDataUpload(event) {
            const fileInput = event.target;
            const uploadArea = document.getElementById('trainingDataUploadArea');

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];

                // 更新上传区域样式
                uploadArea.classList.add('active');
                uploadArea.querySelector('.upload-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                uploadArea.querySelector('.upload-text').innerHTML = `<p>Selected: ${file.name}</p>`;

                // 启用训练按钮
                document.getElementById('saveModelBtn').disabled = false;
            }
        }

        // 开始训练
        function startTraining() {
            if (isTraining) {
                alert('Training is in progress, please wait for completion');
                return;
            }

            // 收集训练参数
            const params = {
                epochs: document.getElementById('param_epochs').value,
                batch_size: document.getElementById('param_batch_size').value,
                learning_rate: document.getElementById('param_learning_rate').value,
                model_type: document.getElementById('param_model_type').value,
                optimizer: document.getElementById('param_optimizer').value,
                pretrained: document.getElementById('param_pretrained').value
            };

            // 更新训练状态
            isTraining = true;
            currentProgress = 0;
            updateTrainingStatus('training', 'Training in progress...');
            updateProgressBar(0, 'Starting training...');

            // 模拟训练过程
            trainingInterval = setInterval(() => {
                currentProgress += Math.random() * 5;
                if (currentProgress >= 100) {
                    currentProgress = 100;
                    finishTraining();
                }

                const statusText = `Training progress: ${Math.round(currentProgress)}% - Epoch ${Math.floor(currentProgress/5)}/${params.epochs}`;
                updateProgressBar(currentProgress, statusText);
            }, 500);
        }

        // 完成训练
        function finishTraining() {
            clearInterval(trainingInterval);
            isTraining = false;
            updateTrainingStatus('completed', 'Training completed');
            updateProgressBar(100, 'Training completed!');

            // 更新模型信息
            document.getElementById('currentModelName').textContent = '2D-Material-Recognition-v1';
            document.getElementById('currentModelAccuracy').textContent = 'Accuracy: 92.5%';
            document.getElementById('currentModelDate').textContent = 'Creation Date: ' + new Date().toLocaleDateString();

            // 更新训练统计
            document.getElementById('trainingLoss').textContent = 'Loss: 0.15';
            document.getElementById('trainingAccuracy').textContent = 'Accuracy: 92.5%';
            document.getElementById('trainingTime').textContent = 'Training Time: 45 minutes';

            // 启用识别按钮
            document.getElementById('runRecognitionBtn').disabled = false;

            alert('Model training completed!');
        }

        // 更新训练状态
        function updateTrainingStatus(status, text) {
            const statusDot = document.getElementById('trainingStatus');
            const statusText = document.getElementById('trainingStatusText');

            statusDot.className = 'status-dot ' + status;
            statusText.textContent = text;
        }

        // 更新进度条
        function updateProgressBar(percent, text) {
            const progressFill = document.getElementById('trainingProgress');
            const progressText = document.getElementById('trainingProgressText');

            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }

        // 重置训练参数
        function resetTrainingParams() {
            document.getElementById('param_epochs').value = '50';
            document.getElementById('param_batch_size').value = '16';
            document.getElementById('param_learning_rate').value = '0.001';
            document.getElementById('param_model_type').value = 'resnet50';
            document.getElementById('param_optimizer').value = 'adam';
            document.getElementById('param_pretrained').value = 'yes';

            alert('Training parameters have been reset to default values');
        }

        // 保存模型
        function saveModel() {
            if (!isTraining) {
                alert('Model saved successfully!');
                // 在实际应用中，这里会调用后端API保存模型
            } else {
                alert('Please wait for training to complete before saving the model');
            }
        }

        // 加载模型
        function loadModel() {
            // 模拟加载模型过程
            updateTrainingStatus('idle', 'Loading model...');

            setTimeout(() => {
                document.getElementById('currentModelName').textContent = '2D-Material-Pretrained';
                document.getElementById('currentModelAccuracy').textContent = 'Accuracy: 94.2%';
                document.getElementById('currentModelDate').textContent = 'Creation Date: 2023-10-15';

                // 启用识别按钮
                document.getElementById('runRecognitionBtn').disabled = false;

                updateTrainingStatus('completed', 'Model loaded successfully');
                alert('Model loaded successfully!');
            }, 1500);
        }

        // 识别图像上传处理
        function handleRecognitionImageUpload(event) {
            const fileInput = event.target;
            const uploadArea = document.getElementById('recognitionImageUploadArea');
            const resultContainer = document.getElementById('recognitionResultContainer');
            const placeholder = document.getElementById('recognitionResultPlaceholder');
            const resultImage = document.getElementById('recognitionResultImage');

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];

                // 更新上传区域样式
                uploadArea.classList.add('active');
                uploadArea.querySelector('.upload-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                uploadArea.querySelector('.upload-text').innerHTML = `<p>Selected: ${file.name}</p>`;

                const reader = new FileReader();
                reader.onload = function(e) {
                    // 显示原图
                    placeholder.style.display = 'none';
                    resultImage.src = e.target.result;
                    resultImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // 运行识别
        function runRecognition() {
            const resultImage = document.getElementById('recognitionResultImage');
            const detailsContainer = document.getElementById('recognitionDetails');
            const classesContainer = document.getElementById('recognitionClasses');

            if (resultImage.style.display === 'none') {
                alert('Please upload an image for recognition first');
                return;
            }

            // 模拟识别过程
            updateTrainingStatus('training', 'Recognizing...');

            setTimeout(() => {
                // 显示识别结果
                detailsContainer.style.display = 'block';

                // 模拟识别结果
                const materials = [
                    { name: 'WS₂', confidence: 0.92 },
                    { name: 'MoS₂', confidence: 0.85 },
                    { name: 'Graphene', confidence: 0.78 },
                    { name: 'h-BN', confidence: 0.65 }
                ];

                let classesHTML = '';
                materials.forEach(material => {
                    classesHTML += `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                            <strong>${material.name}</strong>: ${(material.confidence * 100).toFixed(1)}%
                            <div style="height: 10px; background: #e0e0e0; border-radius: 5px; margin-top: 5px;">
                                <div style="height: 100%; background: #854144; border-radius: 5px; width: ${material.confidence * 100}%;"></div>
                            </div>
                        </div>
                    `;
                });

                classesContainer.innerHTML = classesHTML;
                updateTrainingStatus('completed', 'Recognition completed');

                alert('Material recognition completed!');
            }, 2000);
        }

        // ==================== Step2 图片上传处理 ====================
        function handleStep2ImageUpload(event) {
            const fileInput = event.target;
            const uploadArea = document.getElementById('uploadArea');
            const originalImageContainer = document.getElementById('originalImageContainer');
            const originalPlaceholder = document.getElementById('originalPlaceholder');
            const originalImage = document.getElementById('step2OriginalImage');

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];

                // 更新上传区域样式
                uploadArea.classList.add('active');
                uploadArea.querySelector('.upload-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                uploadArea.querySelector('.upload-text').innerHTML = `<p>Selected: ${file.name}</p>`;

                const reader = new FileReader();
                reader.onload = function(e) {
                    // 显示原图
                    originalPlaceholder.style.display = 'none';
                    originalImage.src = e.target.result;
                    originalImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // ==================== Step2 运行函数 ====================
        function runStep2WithParams() {
            const fileInput = document.getElementById('step2ImageInput');

            if (!fileInput.files || !fileInput.files[0]) {
                alert('Please upload an image first.');
                return;
            }

            // 收集参数
            const params = {
                n_segments: document.getElementById('param_slic_n_segments').value,
                compactness: document.getElementById('param_slic_compactness').value,
                bandwidth: document.getElementById('param_meanshift_bandwidth').value,
                min_area: document.getElementById('param_min_internal_area_post').value,
                top_n: document.getElementById('param_top_n_output').value,
                solidity: document.getElementById('param_shape_solidity_threshold').value,
                kernel_size: document.getElementById('param_morph_kernel_size').value,
                iterations: document.getElementById('param_morph_iterations').value
            };

            // 显示加载状态
            alert('Running Step2 segmentation with parameters: ' + JSON.stringify(params));

            // 在实际应用中，这里应该调用后端API处理图片
            // 这里我们模拟处理结果
            simulateStep2Processing();
        }

        // ==================== 模拟Step2处理 ====================
        function simulateStep2Processing() {
            // 在实际应用中，这里应该是从后端获取处理后的图片
            // 这里我们使用一个预设的图片路径作为分割结果
            // 请将下面的路径替换为实际的分割结果图片路径
            const segmentedImagePath = "runs\\SLIC\\026\\final_result_026.jpg";

            const resultImageContainer = document.getElementById('resultImageContainer');
            const resultPlaceholder = document.getElementById('resultPlaceholder');
            const resultImage = document.getElementById('step2ResultImage');

            // 显示分割结果图片
            resultPlaceholder.style.display = 'none';
            resultImage.src = segmentedImagePath;
            resultImage.style.display = 'block';

            // 添加错误处理，以防图片不存在
            resultImage.onerror = function() {
                resultImage.style.display = 'none';
                resultPlaceholder.style.display = 'block';
                resultPlaceholder.innerHTML = 'Segmented image not found<br>Please check the path: ' + segmentedImagePath;
            };
        }

        // ==================== 重置参数 ====================
        function resetStep2Params() {
            document.getElementById('param_slic_n_segments').value = '3000';
            document.getElementById('param_slic_compactness').value = '5.0';
            document.getElementById('param_meanshift_bandwidth').value = '7';
            document.getElementById('param_min_internal_area_post').value = '500';
            document.getElementById('param_top_n_output').value = '5';
            document.getElementById('param_shape_solidity_threshold').value = '0.65';
            document.getElementById('param_morph_kernel_size').value = '3';
            document.getElementById('param_morph_iterations').value = '2';

            alert('Parameters have been reset to default values.');
        }

        // ==================== Step3 功能函数 ====================
        let isProcessing = false;
        let processingInterval;
        let currentThicknessProgress = 0;

        // 图像上传处理
        function handleStep3ImageUpload(event) {
            const fileInput = event.target;
            const uploadArea = document.getElementById('step3UploadArea');
            const originalContainer = document.getElementById('step3OriginalContainer');
            const originalPlaceholder = document.getElementById('step3OriginalPlaceholder');
            const originalImage = document.getElementById('step3OriginalImage');

            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];

                // 更新上传区域样式
                uploadArea.classList.add('active');
                uploadArea.querySelector('.upload-icon').innerHTML = '<i class="fas fa-check-circle"></i>';
                uploadArea.querySelector('.upload-text').innerHTML = `<p>Selected: ${file.name}</p>`;

                const reader = new FileReader();
                reader.onload = function(e) {
                    // 显示原图
                    originalPlaceholder.style.display = 'none';
                    originalImage.src = e.target.result;
                    originalImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // 运行厚度预测
        function runThicknessPrediction() {
            const fileInput = document.getElementById('step3ImageInput');

            if (!fileInput.files || !fileInput.files[0]) {
                alert('Please upload an image first');
                return;
            }

            if (isProcessing) {
                alert('Thickness prediction is in progress, please wait for completion');
                return;
            }

            // 收集参数
            const params = {
                threshold: document.getElementById('param_threshold').value,
                sensitivity: document.getElementById('param_sensitivity').value,
                min_area: document.getElementById('param_min_area').value,
                calibration: document.getElementById('param_calibration').value,
                confidence: document.getElementById('param_confidence').value
            };

            // 获取结果图片路径
            const resultImagePath = document.getElementById('resultImagePath').value;

            // 更新处理状态
            isProcessing = true;
            currentThicknessProgress = 0;
            updateThicknessStatus('processing', 'Thickness prediction in progress...');
            updateThicknessProgressBar(0, 'Starting thickness prediction...');

            // 模拟处理过程
            processingInterval = setInterval(() => {
                currentThicknessProgress += Math.random() * 8;
                if (currentThicknessProgress >= 100) {
                    currentThicknessProgress = 100;
                    finishThicknessPrediction(resultImagePath);
                }

                const statusText = `Processing progress: ${Math.round(currentThicknessProgress)}% - Analyzing region ${Math.floor(currentThicknessProgress/10)}/10`;
                updateThicknessProgressBar(currentThicknessProgress, statusText);
            }, 500);
        }

        // 完成厚度预测
        function finishThicknessPrediction(resultImagePath) {
            clearInterval(processingInterval);
            isProcessing = false;
            updateThicknessStatus('completed', 'Thickness prediction completed');
            updateThicknessProgressBar(100, 'Thickness prediction completed!');

            // 显示结果图像
            const resultContainer = document.getElementById('step3ResultContainer');
            const resultPlaceholder = document.getElementById('step3ResultPlaceholder');
            const resultImage = document.getElementById('step3ResultImage');

            // 使用用户输入的路径显示结果图像
            resultPlaceholder.style.display = 'none';
            resultImage.src = resultImagePath;
            resultImage.style.display = 'block';

            // 添加错误处理
            resultImage.onerror = function() {
                resultImage.style.display = 'none';
                resultPlaceholder.style.display = 'block';
                resultPlaceholder.innerHTML = 'Thickness prediction result image not found<br>Please check the path: ' + resultImagePath;
            };

            // 显示厚度结果表格
            displayThicknessResults();

            alert('Thickness prediction completed!');
        }

        // 显示厚度结果表格
        function displayThicknessResults() {
            const thicknessResults = document.getElementById('thicknessResults');
            const thicknessChart = document.getElementById('thicknessChart');

            // 直接显示已有的表格内容
            thicknessResults.style.display = 'block';
            thicknessChart.style.display = 'block';
        }

        // 更新厚度预测状态
        function updateThicknessStatus(status, text) {
            const statusDot = document.getElementById('thicknessStatus');
            const statusText = document.getElementById('thicknessStatusText');

            statusDot.className = 'status-dot ' + status;
            statusText.textContent = text;
        }

        // 更新厚度预测进度条
        function updateThicknessProgressBar(percent, text) {
            const progressFill = document.getElementById('thicknessProgress');
            const progressText = document.getElementById('thicknessProgressText');

            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }

        // 重置厚度预测参数
        function resetThicknessParams() {
            document.getElementById('param_threshold').value = '0.15';
            document.getElementById('param_sensitivity').value = '0.7';
            document.getElementById('param_min_area').value = '100';
            document.getElementById('param_calibration').value = '0.25';
            document.getElementById('param_confidence').value = '0.8';
            document.getElementById('resultImagePath').value = '';

            alert('Thickness prediction parameters have been reset to default values');
        }

        // ==================== 其他页面功能 ====================
        function takePicture() {
            alert('Camera functionality would be implemented here');
        }

        function runStep4() {
            alert('Step4 functionality would be implemented here');
        }

        function handleUploadInputChange(event) {
            alert('File upload functionality would be implemented here');
        }

        function retest() {
            alert('Retest functionality would be implemented here');
        }

        function exportCSV() {
            alert('CSV export functionality would be implemented here');
        }

        function exportJPG() {
            alert('JPG export functionality would be implemented here');
        }

        function showCategory(category) {
            alert(`Showing ${category} category - This feature is under development`);
        }

        // ==================== 搜索功能 ====================
        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();

            if (query === '') {
                clearSearch();
                return;
            }

            alert(`Searching for: ${query} - This feature is under development`);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
        }
    </script>
</body>
</html>